"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[982],{83708:function(e,n){n.Z={ENTER_KEYCODE:13,TAB_KEYCODE:9,AVAILABLE_BILLS:[2e3,5e3,1e4,2e4,5e4,1e5]}},59931:function(e,n,r){r.d(n,{Sm:function(){return l},Um:function(){return o},y1:function(){return u}});var t=r(93433),s=r(74165),c=r(15861),i=r(7933),a=r(50500),u=function(e){return function(){var n=(0,c.Z)((0,s.Z)().mark((function n(r,t,c){var u,o;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.Z)();case 2:if(!n.sent){n.next=9;break}return n.next=6,c.post("/billings",e);case 6:n.t0=n.sent,n.next=10;break;case 9:n.t0=d(r,t(),e);case 10:u=n.t0,o=u.status,r(201===o?(0,i.zm)(!0):(0,i.zm)(!1));case 13:case"end":return n.stop()}}),n)})));return function(e,r,t){return n.apply(this,arguments)}}()},o=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).page,n=void 0===e?1:e;return function(){var e=(0,c.Z)((0,s.Z)().mark((function e(r,t,c){var u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.Z)();case 2:if(!e.sent){e.next=9;break}return e.next=6,c.get("/billings?page=".concat(n));case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=f(r,t());case 10:u=e.t0,o=u.data,200===u.status&&r((0,i.u0)(o));case 14:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}()},l=function(e){return function(){var n=(0,c.Z)((0,s.Z)().mark((function n(r,t,c){var a,u;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.get("/billings/per/".concat(e));case 2:a=n.sent,u=a.data,200===a.status&&r((0,i.u0)(u));case 6:case"end":return n.stop()}}),n)})));return function(e,r,t){return n.apply(this,arguments)}}()};function d(e,n,r){var s=n.billing.offline.billings,c=[];if(Array.isArray(s)){var a=JSON.parse(JSON.stringify(s));c=[].concat((0,t.Z)(c),(0,t.Z)(a))}return c.unshift(r),e((0,i.Jv)(c)),{status:201}}function f(e,n){var r=[n.billing.offline.billings];return r.length>10&&(r.length=10),e((0,i.u0)(r)),{data:r,status:200}}},51982:function(e,n,r){r.r(n),r.d(n,{default:function(){return E}});var t=r(4942),s=r(74165),c=r(93433),i=r(1413),a=r(15861),u=r(29439),o=r(72791),l=r(59434),d=r(78983),f=(r(42087),r(2703)),h=r(72698),x=r(47149),m=r(83708),p=r(80184),j=m.Z.ENTER_KEYCODE,v=m.Z.TAB_KEYCODE,b=function(e){var n=(0,l.I0)(),r=(0,l.v9)((function(e){return e.items.items})),t=(0,o.useState)(""),c=(0,u.Z)(t,2),i=c[0],m=c[1],b=(0,o.useState)(!1),g=(0,u.Z)(b,2),Z=g[0],y=g[1],N=(0,o.useRef)(),C=(0,o.useCallback)((function(){n((0,h.U7)([])),m(""),N.current.focus()}),[n]);(0,o.useEffect)((function(){C()}),[C]);var k=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.keyCode,[j,v].includes(t)&&(w(),setTimeout((function(){r.length>0&&A(r[0])}),500));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),w=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(r){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=null!==r&&void 0!==r?r:i)&&n((0,x.kk)({code:t,name:t,page:1}));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),A=function(n){e.addItem(n),C()};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(d.KB,{fluid:!0,children:[(0,p.jsx)(d.rb,{children:(0,p.jsx)(d.b7,{children:(0,p.jsxs)(d.YR,{children:[(0,p.jsx)(d.jO,{ref:N,type:"text",name:"searchTerm",placeholder:"Buscar",value:i,onChange:function(e){return function(e){var n=e.target.value;m(n),w(n)}(e)},onKeyDown:function(e){return k(e)}}),(0,p.jsx)(d.u5,{variant:"outline",type:"button",color:"secondary",onClick:C,children:"BORRAR"})]})})}),(0,p.jsx)(d.rb,{children:(0,p.jsx)(d.b7,{children:(0,p.jsxs)(d.Sx,{hover:!0,children:[(0,p.jsx)(d.V,{children:(0,p.jsxs)(d.T6,{children:[(0,p.jsx)(d.is,{children:"Nombre"}),(0,p.jsx)(d.is,{children:"Precio"})]})}),(0,p.jsx)(d.NR,{children:r.map((function(e){return(0,p.jsxs)(d.T6,{onClick:function(){return A(e)},style:{cursor:"pointer"},children:[(0,p.jsxs)(d.NN,{xs:"12",children:[(0,p.jsx)(d.rb,{children:(0,p.jsx)(d.b7,{className:"text-uppercase",children:e.name})}),(0,p.jsx)(d.rb,{children:(0,p.jsx)(d.b7,{style:{fontSize:10},children:e.code})})]}),(0,p.jsx)(d.NN,{className:"text-break",children:(0,f.x)(e.price)})]},e.code)}))})]})})})]}),(0,p.jsxs)(d.Tk,{visible:Z,onClose:function(){return y(!1)},children:[(0,p.jsx)(d.p0,{children:(0,p.jsx)(d.fl,{children:"Scanning"})}),(0,p.jsx)(d.sD,{children:(0,p.jsx)("div",{id:"reader",width:"600px",style:{maxWidth:"750px"}})}),(0,p.jsx)(d.Ym,{children:(0,p.jsx)(d.u5,{Ccolor:"secondary",onClick:function(){return y(!1)},children:"Close"})})]})]})},g=r(24846),Z=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M96,472a23.82,23.82,0,0,0,23.579,24H392.421A23.82,23.82,0,0,0,416,472V152H96Zm32-288H384V464H128Z' class='ci-primary'/><rect width='32' height='200' x='168' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='240' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='312' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M328,88V40c0-13.458-9.488-24-21.6-24H205.6C193.488,16,184,26.542,184,40V88H64v32H448V88ZM216,48h80V88H216Z' class='ci-primary'/>"],y=m.Z.ENTER_KEYCODE,N=m.Z.TAB_KEYCODE,C=function(e){var n=(0,o.useState)(0),r=(0,u.Z)(n,2),t=r[0],c=r[1],i=(0,o.useState)(!1),l=(0,u.Z)(i,2),h=l[0],x=l[1],j=(0,o.useState)(0),v=(0,u.Z)(j,2),b=v[0],g=v[1],Z=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.keyCode,[y,N].includes(r)&&C();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),C=function(n){var r=null!==n&&void 0!==n?n:t;x(r<e.total),g(r-e.total)};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(d.KB,{fluid:!0,children:[(0,p.jsx)(d.rb,{children:m.Z.AVAILABLE_BILLS.map((function(n){return(0,p.jsx)(d.b7,{lg:"6",className:"mt-2",style:{cursor:"pointer"},children:(0,p.jsx)(d.xH,{onClick:function(){return function(n){c(n),e.setReceivedAmount(n),C(n)}(n)},children:(0,p.jsx)(d.sl,{children:(0,p.jsx)("h4",{className:"text-center",children:(0,f.x)(n)})})})},n)}))}),(0,p.jsxs)(d.rb,{className:"mt-4",children:[(0,p.jsx)(d.b7,{lg:"4",children:(0,p.jsx)("h5",{children:"RECIBIDO"})}),(0,p.jsx)(d.b7,{lg:"8",children:(0,p.jsx)(d.jO,{"data-testid":"receivedAmountId",type:"number",size:"lg",name:"receivedAmount",feedbackInvalid:"El monto recibido no debe ser menor al total",invalid:h,value:t,onChange:function(n){return function(n){var r=n.target.value;c(r),e.setReceivedAmount(r),C(r)}(n)},onKeyDown:function(e){return Z(e)}})})]}),(0,p.jsxs)(d.rb,{className:"mt-4",children:[(0,p.jsx)(d.b7,{lg:"4",children:(0,p.jsx)("h5",{children:"CAMBIO"})}),(0,p.jsx)(d.b7,{lg:"8",className:"align-self-end",children:(0,p.jsx)("span",{className:"fs-3",children:(0,f.x)(b)})})]})]})})},k=r(59931),w=r(43744),A=r(7933);var E=function(){var e=(0,l.v9)((function(e){return e.billing.saveSuccess})),n=(0,l.I0)(),r=(0,o.useState)([]),h=(0,u.Z)(r,2),x=h[0],m=h[1],j=(0,o.useState)(0),v=(0,u.Z)(j,2),y=v[0],N=v[1],E=(0,o.useState)(0),S=(0,u.Z)(E,2),R=S[0],_=S[1],O=(0,o.useState)({}),B=(0,u.Z)(O,2),I=B[0],T=B[1],D=(0,o.useState)(!1),Y=(0,u.Z)(D,2),H=Y[0],K=Y[1],V=y<R,z=x.length<=0;(0,o.useEffect)((function(){n((0,w.r2)(!0))}),[n]);var L=(0,o.useCallback)((function(){m([]),N(0),_(0),T({}),n((0,w.js)({message:"Guardado exitoso!",color:"success",delay:2e3})),n((0,w.W3)(!0)),n((0,A.zm)(!1))}),[n]);(0,o.useEffect)((function(){e&&L()}),[e,L]);var F=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n){var r,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},M(n.code)?r[n.code]=I[n.code]+1:r[n.code]=1,r=(0,i.Z)((0,i.Z)({},I),r),T(r),t=(0,c.Z)(x),M(n.code)||t.unshift(n),m(t),U(t,r);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),M=function(e){return x.some((function(n){return n.code===e}))},U=function(e,n){var r=e.map((function(e){var r=e.price,t=e.code;return r*n[t]})).reduce((function(e,n){return+e+ +n}),0);_(r)},W=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!V){e.next=4;break}return n((0,w.js)({message:"Revisa el monto recibido y el total",color:"warning"})),n((0,w.W3)(!0)),e.abrupt("return");case 4:if(!z){e.next=8;break}return n((0,w.js)({message:"No hay productos por facturar",color:"warning"})),n((0,w.W3)(!0)),e.abrupt("return");case 8:n((0,k.y1)({receivedAmount:y,billAmount:R,items:P(x)})),K(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){return x.map((function(e){return{_id:e._id,name:e.name,code:e.code,price:e.price,units:e.units,measurementUnit:e.measurementUnit}}))};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(d.KB,{className:"mt--6",fluid:!0,children:[(0,p.jsxs)(d.rb,{children:[(0,p.jsx)(d.b7,{lg:"5",children:(0,p.jsx)(d.xH,{className:"shadow border-10",style:{height:"78vh"},children:(0,p.jsx)(d.sl,{style:{overflow:"auto"},children:(0,p.jsxs)(d.Sx,{hover:!0,children:[(0,p.jsx)(d.V,{children:(0,p.jsxs)(d.T6,{children:[(0,p.jsx)(d.is,{children:"Producto"}),(0,p.jsx)(d.is,{children:"Cantidad"}),(0,p.jsx)(d.is,{children:"Subtotal"}),(0,p.jsx)(d.is,{children:"\xa0"})]})}),(0,p.jsx)(d.NR,{children:x.map((function(e){var n=e.code,r=e.name,s=e.price;return(0,p.jsxs)(d.T6,{children:[(0,p.jsxs)(d.NN,{xs:"12",children:[(0,p.jsx)(d.rb,{children:(0,p.jsx)(d.b7,{className:"text-uppercase",children:r})}),(0,p.jsx)(d.rb,{children:(0,p.jsx)(d.b7,{style:{fontSize:10},children:n})})]}),(0,p.jsx)(d.NN,{colSpan:1,children:(0,p.jsx)(d.jO,{style:{maxWidth:60},type:"number",min:1,formNoValidate:!0,size:"sm",name:n,value:I[n],onChange:function(e){return function(e){var n=e.target,r=n.name,s=n.value,c=(0,i.Z)((0,i.Z)({},I),{},(0,t.Z)({},r,s));T(c),U(x,c)}(e)}})}),(0,p.jsx)(d.NN,{xs:"12",className:"text-break",children:(0,f.x)(s*I[n])}),(0,p.jsx)(d.NN,{children:(0,p.jsx)(d.u5,{size:"sm",color:"ligth",onClick:function(){return function(e){var n=Object.assign([],x),r=Object.assign([],I),t=n.findIndex((function(n){return n.code===e}));delete r[e],-1!==t&&n.splice(t,1),m(n),T(r),U(n,r)}(n)},children:(0,p.jsx)(g.Z,{icon:Z,size:"sm"})})})]},n)}))})]})})})}),(0,p.jsx)(d.b7,{lg:"7",children:(0,p.jsx)(d.xH,{className:"shadow border-10",style:{height:"78vh",overflowY:"auto"},children:(0,p.jsxs)(d.sl,{children:[!H&&(0,p.jsx)(b,{addItem:F}),H&&(0,p.jsx)(C,{setReceivedAmount:function(e){return N(e)},total:R})]})})})]}),(0,p.jsx)(d.rb,{className:"mt-3 align-items-end",children:(0,p.jsx)(d.xH,{className:"shadow border-10",children:(0,p.jsx)(d.sl,{children:(0,p.jsxs)(d.rb,{className:"mt-3",children:[(0,p.jsx)(d.b7,{lg:"5",children:(0,p.jsx)("div",{className:"d-grid gap-2",children:(0,p.jsx)(d.u5,{size:"lg",color:H?"success":"primary",onClick:H?W:function(){K(!0)},disabled:H?V:z,children:H?"FACTURAR":"COBRAR"})})}),(0,p.jsxs)(d.b7,{lg:"6",className:"fs-1",children:[(0,p.jsx)("span",{children:"POR COBRAR"}),"\xa0",(0,f.x)(R)]})]})})})})]})})}},2703:function(e,n,r){r.d(n,{p:function(){return i},x:function(){return c}});var t=r(97892),s=r.n(t),c=function(e){return Number.isInteger(e)&&e>=0?new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(e):e},i=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD-MM-YYYY hh:mm a";return s()(e).format(n)}}}]);
//# sourceMappingURL=982.7a35c993.chunk.js.map