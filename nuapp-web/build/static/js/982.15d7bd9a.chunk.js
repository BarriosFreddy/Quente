"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[982],{83708:function(e,n){n.Z={ENTER_KEYCODE:13,TAB_KEYCODE:9,AVAILABLE_BILLS:[2e3,5e3,1e4,2e4,5e4,1e5]}},99262:function(e,n,r){r.d(n,{l:function(){return c}});var t=r(72791),c=function(e,n){var r=(0,t.useRef)(!1);(0,t.useEffect)((function(){if(r.current)return e();r.current=!0}),n)}},59931:function(e,n,r){r.d(n,{Fd:function(){return l},Sm:function(){return f},Um:function(){return d},y1:function(){return o}});var t=r(93433),c=r(74165),s=r(15861),i=r(7933),a=r(50500),u=!1,o=function(e){return function(){var n=(0,s.Z)((0,c.Z)().mark((function n(r,t,s){var o,l;return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.Z)();case 2:if(u=n.sent,r((0,i.K4)(!0)),!u){n.next=10;break}return n.next=7,s.post("/billings",e);case 7:n.t0=n.sent,n.next=11;break;case 10:n.t0=h(r,t(),e);case 11:o=n.t0,l=o.status,r(201===l?(0,i.zm)(!0):(0,i.zm)(!1)),r((0,i.K4)(!1));case 15:case"end":return n.stop()}}),n)})));return function(e,r,t){return n.apply(this,arguments)}}()},l=function(e){return function(){var n=(0,s.Z)((0,c.Z)().mark((function n(r,t,s){var o,l;return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.Z)();case 2:return u=n.sent,r((0,i.K4)(!0)),n.next=6,s.post("/billings/bulk",e);case 6:o=n.sent,l=o.status,r(201===l?(0,i.zm)(!0):(0,i.zm)(!1)),r((0,i.K4)(!1));case 10:case"end":return n.stop()}}),n)})));return function(e,r,t){return n.apply(this,arguments)}}()},d=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).page,n=void 0===e?1:e;return function(){var e=(0,s.Z)((0,c.Z)().mark((function e(r,t,s){var o,l;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.Z)();case 2:if(!(u=e.sent)){e.next=9;break}return e.next=6,s.get("/billings?page=".concat(n));case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=x(r,t());case 10:o=e.t0,l=o.data,200===o.status&&r((0,i.u0)(l));case 14:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}()},f=function(e){return function(){var n=(0,s.Z)((0,c.Z)().mark((function n(r,t,s){var a,u;return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.get("/billings/per/".concat(e));case 2:a=n.sent,u=a.data,200===a.status&&r((0,i.u0)(u));case 6:case"end":return n.stop()}}),n)})));return function(e,r,t){return n.apply(this,arguments)}}()};function h(e,n,r){var c=n.billing.offline.billings,s=[];if(Array.isArray(c)){var a=JSON.parse(JSON.stringify(c));s=[].concat((0,t.Z)(s),(0,t.Z)(a))}return s.unshift(r),e((0,i.Jv)(s)),{status:201}}function x(e,n){var r=[n.billing.offline.billings];return r.length>10&&(r.length=10),e((0,i.u0)(r)),{data:r,status:200}}},51982:function(e,n,r){r.r(n),r.d(n,{default:function(){return T}});var t=r(4942),c=r(74165),s=r(93433),i=r(1413),a=r(15861),u=r(29439),o=r(72791),l=r(59434),d=r(78983),f=(r(42087),r(2703)),h=r(72698),x=r(47149),m=r(83708),p=r(99262),v=r(80184),j=m.Z.ENTER_KEYCODE,b=m.Z.TAB_KEYCODE,g=function(e){var n=(0,l.I0)(),r=(0,l.v9)((function(e){return e.items.items})),t=(0,l.v9)((function(e){return e.items.loading})),s=(0,o.useState)(""),i=(0,u.Z)(s,2),m=i[0],g=i[1],Z=(0,o.useState)(!1),y=(0,u.Z)(Z,2),N=y[0],C=y[1],w=(0,o.useRef)(),k=(0,o.useCallback)((function(){n((0,h.U7)([])),g(""),w.current.focus()}),[n]);(0,o.useEffect)((function(){k()}),[k]),(0,p.l)((function(){1===r.length&&O(r[0])}),[t]);var A=function(){var e=(0,a.Z)((0,c.Z)().mark((function e(n){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.keyCode,[j,b].includes(t)&&(E(),setTimeout((function(){1===r.length&&O(r[0])}),500));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),E=function(){var e=(0,a.Z)((0,c.Z)().mark((function e(r){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=null!==r&&void 0!==r?r:m)&&n((0,x.kk)({code:t,name:t,page:1},!0));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(n){e.addItem(n),k()};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(d.KB,{fluid:!0,children:[(0,v.jsx)(d.rb,{children:(0,v.jsx)(d.b7,{children:(0,v.jsxs)(d.YR,{children:[(0,v.jsx)(d.jO,{ref:w,type:"text",name:"searchTerm",placeholder:"Buscar",value:m,onChange:function(e){return function(e){var n=e.target.value;g(n),E(n)}(e)},onKeyDown:function(e){return A(e)}}),(0,v.jsx)(d.u5,{variant:"outline",type:"button",color:"secondary",onClick:k,children:"BORRAR"})]})})}),(0,v.jsx)(d.rb,{children:(0,v.jsx)(d.b7,{children:(0,v.jsxs)(d.Sx,{hover:!0,children:[(0,v.jsx)(d.V,{children:(0,v.jsxs)(d.T6,{children:[(0,v.jsx)(d.is,{children:"Nombre"}),(0,v.jsx)(d.is,{children:"Precio"})]})}),(0,v.jsx)(d.NR,{children:r.map((function(e){return(0,v.jsxs)(d.T6,{onClick:function(){return O(e)},style:{cursor:"pointer"},children:[(0,v.jsxs)(d.NN,{xs:"12",children:[(0,v.jsx)(d.rb,{children:(0,v.jsx)(d.b7,{className:"text-uppercase",children:e.name})}),(0,v.jsx)(d.rb,{children:(0,v.jsx)(d.b7,{style:{fontSize:10},children:e.code})})]}),(0,v.jsx)(d.NN,{className:"text-break",children:(0,f.x)(e.price)})]},e.code)}))})]})})})]}),(0,v.jsxs)(d.Tk,{visible:N,onClose:function(){return C(!1)},children:[(0,v.jsx)(d.p0,{children:(0,v.jsx)(d.fl,{children:"Scanning"})}),(0,v.jsx)(d.sD,{children:(0,v.jsx)("div",{id:"reader",width:"600px",style:{maxWidth:"750px"}})}),(0,v.jsx)(d.Ym,{children:(0,v.jsx)(d.u5,{Ccolor:"secondary",onClick:function(){return C(!1)},children:"Close"})})]})]})},Z=r(24846),y=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M96,472a23.82,23.82,0,0,0,23.579,24H392.421A23.82,23.82,0,0,0,416,472V152H96Zm32-288H384V464H128Z' class='ci-primary'/><rect width='32' height='200' x='168' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='240' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='312' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M328,88V40c0-13.458-9.488-24-21.6-24H205.6C193.488,16,184,26.542,184,40V88H64v32H448V88ZM216,48h80V88H216Z' class='ci-primary'/>"],N=m.Z.ENTER_KEYCODE,C=m.Z.TAB_KEYCODE,w=function(e){var n=(0,o.useState)(0),r=(0,u.Z)(n,2),t=r[0],s=r[1],i=(0,o.useState)(!1),l=(0,u.Z)(i,2),h=l[0],x=l[1],p=(0,o.useState)(0),j=(0,u.Z)(p,2),b=j[0],g=j[1],Z=(0,o.useRef)();(0,o.useEffect)((function(){Z.current.focus(),Z.current.select()}),[]);var y=function(){var e=(0,a.Z)((0,c.Z)().mark((function e(n){var r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.keyCode,[N,C].includes(r)&&w();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),w=function(n){var r=null!==n&&void 0!==n?n:t;x(r<e.total),g(r-e.total)};return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(d.KB,{fluid:!0,children:[(0,v.jsx)(d.rb,{children:m.Z.AVAILABLE_BILLS.map((function(n){return(0,v.jsx)(d.b7,{lg:"6",className:"mt-2",style:{cursor:"pointer"},children:(0,v.jsx)(d.xH,{onClick:function(){return function(n){s(n),e.setReceivedAmount(n),w(n)}(n)},children:(0,v.jsx)(d.sl,{children:(0,v.jsx)("h4",{className:"text-center",children:(0,f.x)(n)})})})},n)}))}),(0,v.jsxs)(d.rb,{className:"mt-4",children:[(0,v.jsx)(d.b7,{lg:"4",children:(0,v.jsx)("h5",{children:"RECIBIDO"})}),(0,v.jsx)(d.b7,{lg:"8",children:(0,v.jsx)(d.jO,{ref:Z,"data-testid":"receivedAmountId",type:"number",size:"lg",name:"receivedAmount",feedbackInvalid:"El monto recibido no debe ser menor al total",invalid:h,value:t,onChange:function(n){return function(n){var r=n.target.value;s(r),e.setReceivedAmount(r),w(r)}(n)},onKeyDown:function(e){return y(e)}})})]}),(0,v.jsxs)(d.rb,{className:"mt-4",children:[(0,v.jsx)(d.b7,{lg:"4",children:(0,v.jsx)("h5",{children:"CAMBIO"})}),(0,v.jsx)(d.b7,{lg:"8",className:"align-self-end",children:(0,v.jsx)("span",{className:"fs-3",children:(0,f.x)(b)})})]})]})})},k=r(59931),A=r(43744),E=r(7933),O=r(54270),R=r(79926),S=r(97892),_=r.n(S),I=r(83027),B=r.n(I);_().extend(B());var T=function(){var e=(0,l.v9)((function(e){return e.billing.saveSuccess})),n=(0,l.I0)(),r=(0,o.useState)([]),h=(0,u.Z)(r,2),x=h[0],m=h[1],j=(0,o.useState)(0),b=(0,u.Z)(j,2),N=b[0],C=b[1],S=(0,o.useState)(0),I=(0,u.Z)(S,2),B=I[0],T=I[1],K=(0,o.useState)({}),D=(0,u.Z)(K,2),Y=D[0],z=D[1],H=(0,o.useState)(!1),V=(0,u.Z)(H,2),F=V[0],L=V[1],M=N<B,U=x.length<=0;(0,o.useEffect)((function(){return n((0,A.hw)(!1)),n((0,A.r2)(!0)),function(){n((0,A.hw)(!0))}}),[n]),(0,p.l)((function(){m([]),C(0),T(0),z({}),(0,R.G)(n,{message:"Guardado exitosamente!"}),n((0,E.zm)(!1))}),[e]);var W=function(){var e=(0,a.Z)((0,c.Z)().mark((function e(n){var r,t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},P(n.code)?r[n.code]=Y[n.code]+1:r[n.code]=1,r=(0,i.Z)((0,i.Z)({},Y),r),z(r),t=(0,s.Z)(x),P(n.code)||t.unshift(n),m(t),G(t,r);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),P=function(e){return x.some((function(n){return n.code===e}))},G=function(e,n){var r=e.map((function(e){var r=e.price,t=e.code;return r*n[t]})).reduce((function(e,n){return+e+ +n}),0);T(r)},J=function(){var e=(0,a.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!M){e.next=4;break}return n((0,A.js)({message:"Revisa el monto recibido y el total",color:"warning"})),n((0,A.W3)(!0)),e.abrupt("return");case 4:if(!U){e.next=8;break}return n((0,A.js)({message:"No hay productos por facturar",color:"warning"})),n((0,A.W3)(!0)),e.abrupt("return");case 8:n((0,k.y1)({createdAt:{date:_()().utc().valueOf(),offset:6e4*_()().utcOffset()},receivedAmount:N,billAmount:B,items:q(x)})),L(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=function(){return x.map((function(e){var n=e._id,r=e.name,t=e.code,c=e.price,s=e.measurementUnit;return{_id:n,name:r,code:t,price:c,units:Y[t],measurementUnit:s}}))};return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(d.KB,{className:"mt-3",fluid:!0,children:[(0,v.jsx)(O.q,{children:(0,v.jsx)("title",{children:"FACTURACI\xd3N"})}),(0,v.jsxs)(d.rb,{children:[(0,v.jsx)(d.b7,{lg:"5",children:(0,v.jsx)(d.xH,{className:"shadow border-10",style:{height:"78vh"},children:(0,v.jsx)(d.sl,{style:{overflow:"auto"},children:(0,v.jsxs)(d.Sx,{hover:!0,children:[(0,v.jsx)(d.V,{children:(0,v.jsxs)(d.T6,{children:[(0,v.jsx)(d.is,{children:"Producto"}),(0,v.jsx)(d.is,{children:"Cantidad"}),(0,v.jsx)(d.is,{children:"Subtotal"}),(0,v.jsx)(d.is,{children:"\xa0"})]})}),(0,v.jsx)(d.NR,{children:x.map((function(e){var n=e.code,r=e.name,c=e.price;return(0,v.jsxs)(d.T6,{children:[(0,v.jsxs)(d.NN,{xs:"12",children:[(0,v.jsx)(d.rb,{children:(0,v.jsx)(d.b7,{className:"text-uppercase",children:r})}),(0,v.jsx)(d.rb,{children:(0,v.jsx)(d.b7,{style:{fontSize:10},children:n})})]}),(0,v.jsx)(d.NN,{colSpan:1,children:(0,v.jsx)(d.jO,{style:{maxWidth:60},type:"number",min:1,formNoValidate:!0,size:"sm",name:n,value:Y[n],onChange:function(e){return function(e){var n=e.target,r=n.name,c=n.value,s=(0,i.Z)((0,i.Z)({},Y),{},(0,t.Z)({},r,c));z(s),G(x,s)}(e)}})}),(0,v.jsx)(d.NN,{xs:"12",className:"text-break",children:(0,f.x)(c*Y[n])}),(0,v.jsx)(d.NN,{children:(0,v.jsx)(d.u5,{size:"sm",color:"ligth",onClick:function(){return function(e){var n=Object.assign([],x),r=Object.assign([],Y),t=n.findIndex((function(n){return n.code===e}));delete r[e],-1!==t&&n.splice(t,1),m(n),z(r),G(n,r)}(n)},children:(0,v.jsx)(Z.Z,{icon:y,size:"sm"})})})]},n)}))})]})})})}),(0,v.jsx)(d.b7,{lg:"7",children:(0,v.jsx)(d.xH,{className:"shadow border-10",style:{height:"78vh",overflowY:"auto"},children:(0,v.jsxs)(d.sl,{children:[!F&&(0,v.jsx)(g,{addItem:W}),F&&(0,v.jsx)(w,{setReceivedAmount:function(e){return C(e)},total:B})]})})})]}),(0,v.jsx)(d.rb,{className:"mt-3 align-items-end",children:(0,v.jsx)(d.xH,{className:"shadow border-10",children:(0,v.jsx)(d.sl,{children:(0,v.jsxs)(d.rb,{className:"mt-3",children:[(0,v.jsx)(d.b7,{lg:"5",children:(0,v.jsx)("div",{className:"d-grid gap-2",children:(0,v.jsx)(d.u5,{type:"button",size:"lg",color:F?"success":"primary",onClick:F?J:function(){L(!0)},disabled:F?M:U,children:F?"FACTURAR":"COBRAR"})})}),(0,v.jsxs)(d.b7,{lg:"6",className:"fs-1",children:[(0,v.jsx)("span",{children:"POR COBRAR"}),"\xa0",(0,f.x)(B)]})]})})})})]})})}},79926:function(e,n,r){r.d(n,{G:function(){return c}});var t=r(43744),c=function(e,n){var r=n.message,c=n.color,s=void 0===c?"success":c,i=n.delay,a=void 0===i?2e3:i;r||console.error("Toast notification must have a message"),e((0,t.js)({message:r,color:s,delay:a})),e((0,t.W3)(!0))}},2703:function(e,n,r){r.d(n,{p:function(){return u},x:function(){return a}});var t=r(97892),c=r.n(t),s=r(83027),i=r.n(s);c().extend(i());var a=function(e){return Number.isInteger(e)&&e>=0?new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(e):e},u=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD-MM-YYYY hh:mm a";if("string"===typeof e)return c()(e).utcOffset(-300).format(n);var r=e||{},t=r.date,s=r.offset;return t&&s?c()(t).utcOffset(s/6e4).format(n):""}}}]);
//# sourceMappingURL=982.15d7bd9a.chunk.js.map