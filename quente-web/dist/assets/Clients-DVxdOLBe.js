import{ai as V,L as me,aj as xe,ak as he,al as w,am as K,an as Y,u as M,c as v,r as m,j as e}from"./index-zLCb2fgV.js";import{H as pe}from"./Helmet-C40K-Xy2.js";import{t as Q,H as U,D as b,E as r,O as x,I as B,J as ge,a5 as W,M as J,V as Ce,W as je,X as A,Y as q,Z as fe,_ as E,b as I,a9 as ye,P as be,K as ve,a7 as Ne}from"./index.esm-CGtd4b9a.js";import{c as Te}from"./cil-plus-DmDyxMpI.js";import{c as Se}from"./cil-search-C59ySTwT.js";import{c as Pe}from"./cil-trash-Bi1lSbbJ.js";import{C as Ee}from"./constants-DN2KnU_M.js";import{s as H}from"./notification.service-CZX6zi9-.js";import{u as Re}from"./useDidUpdateControl-CLy3MrI-.js";import{P as R,p}from"./DefaultLayout-Dp8_4Mli.js";import{F as O}from"./FormInput-uIO3-47D.js";import{C as Ie}from"./ConfirmDialog-vCIEtcfF.js";import{c as De,a as ke}from"./cil-pencil-c5jg0gho.js";let $=!1;const Fe=n=>async(i,d,c)=>{try{i(w(!0));const{status:a}=await c.post("/clients",n);i(K(a===201))}catch(a){console.error("Error saving client:",a)}finally{i(w(!1))}},Ae=n=>async(i,d,c)=>{try{i(w(!0));const a={...n},o=a._id;delete a._id;const{status:u}=await c.put(`/clients/${o}`,a);i(K(u===201))}catch(a){console.error("Error updating client:",a)}finally{i(w(!1))}},G=(n,i=!1)=>async(d,c,a)=>{try{d(V(!0));const o=new URLSearchParams(n).toString();$=i?!1:await me();const{data:u,status:h}=$?await a.get(`/clients${o.length>0?"?"+o.toString():""}`):we(c(),n);h===200&&d(xe(u))}catch(o){console.error("Error fetching clients:",o)}finally{d(V(!1))}},Oe=n=>async(i,d,c)=>{try{if(!n)return;const{data:a,status:o}=await c.get(`/clients/dni/exists/${n}`);o===200&&i(Y(a))}catch(a){console.error("Error checking existence by DNI:",a)}},Ze=n=>async(i,d,c)=>{try{if(!n)return;const{data:a,status:o}=await c.get(`/clients/dni/${n}`);o===200&&i(he(a))}catch(a){console.error("Error fetching client by DNI:",a)}};function we(n,i){const{clients:d}=n.clients.offline;let c=d.filter(({code:a,name:o})=>a.toUpperCase().includes(i.code.toUpperCase())||o.toUpperCase().includes(i.name.toUpperCase()));return c.length>10&&(c.length=10),{data:c,status:200}}const L={name:"",dniType:"",dni:"",email:"",phoneNumber:"",address:""},_e=[{label:"CÉDULA",value:"CC"},{label:"PASAPORTE",value:"P"}];function X(n){const i=M(),d=v(s=>s.clients.existsByDNI),c=v(s=>s.clients.saving),[a,o]=m.useState(L),[u,h]=m.useState({name:!1,dniType:!1,dni:!1}),t=m.useRef();m.useEffect(()=>{if(n.client){let s=null;n.copying?(s={...n.client,dni:""},delete s._id):s=n.client,o(s)}},[i,n.client,n.copying]);const C=n.client?.dni,D=s=>{C!==s&&i(Oe(s))},N=()=>{const{name:s,dniType:f,dni:F}={...a},y={...u};return y.dni=!F,y.dniType=!f,y.name=!s,h(y),Object.values(y).every(_=>_===!1)},T=async()=>{N()&&(n.onSave({...a}),o(L))},j=()=>{t.current.show(!0)},k=s=>{if(s){n.onCancel(),o(L),i(Y(!1));return}t.current.show(!1)},g=({target:{name:s,value:f}})=>{o({...a,[s]:f}),h({...u,[s]:!f}),s==="dni"&&D(f)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{fluid:!0,children:e.jsxs(U,{children:[e.jsx("div",{className:"py-1 d-lg-none",children:e.jsxs(b,{className:"m-1",children:[e.jsx(r,{xs:"3",lg:{offset:4,span:4},children:e.jsx(x,{size:"sm",variant:"outline",color:"secondary",onClick:()=>j(),children:"CANCELAR"})}),e.jsx(r,{xs:{offset:5,span:4},children:e.jsx(x,{size:"sm",color:"success",type:"button",onClick:()=>T(),children:n.client?"EDITAR":"GUARDAR"})})]})}),e.jsx(B,{children:e.jsxs(ge,{className:"row g-3 needs-validation",noValidate:!0,children:[e.jsxs(b,{children:[e.jsx(r,{xs:"12",lg:"4",children:e.jsx(O,{className:"text-uppercase",label:"Nombre",type:"text",uppercase:"true",name:"name",value:a.name,feedbackInvalid:"Campo obligatorio",invalid:u.name,required:!0,onChange:s=>g(s)})}),e.jsx(r,{xs:"12",lg:"4",children:e.jsx(W,{size:"sm",label:"Tipo de identificación",name:"dniType",value:a.dniType,required:!0,feedbackInvalid:"Campo obligatorio",invalid:u.dniType,onChange:s=>g(s),"aria-label":"Default select example",options:["Seleccione...",..._e]})}),e.jsx(r,{xs:"12",lg:"4",children:e.jsx(O,{className:"text-uppercase",label:"Identificación",type:"text",uppercase:"true",name:"dni",value:a.dni,feedback:d?"Identificación ya registrada":"Campo obligatorio",invalid:d||u.dni,required:!0,onChange:s=>g(s)})})]}),e.jsxs(b,{children:[e.jsx(r,{xs:"12",lg:"4",children:e.jsx(J,{size:"sm",label:"Correo electrónico",type:"email",uppercase:"true",name:"email",value:a.email,onChange:s=>g(s)})}),e.jsx(r,{xs:"12",lg:"4",children:e.jsx(O,{label:"Celular",type:"tel",min:1,name:"phoneNumber",value:a.phoneNumber,onChange:s=>g(s)})}),e.jsx(r,{xs:"12",lg:"4",children:e.jsx(O,{label:"Dirección",type:"text",name:"address",value:a.address,onChange:s=>g(s)})})]})]})}),e.jsx("div",{className:"d-none d-lg-block",children:e.jsxs(b,{className:"m-1",children:[e.jsx(r,{className:"text-center",lg:{offset:3,span:3},children:e.jsx(x,{size:"sm",color:"success",type:"button",disabled:c,onClick:()=>T(),children:n.client&&n.client?.id?"EDITAR":"GUARDAR"})}),e.jsx(r,{className:"text-center",lg:"3",children:e.jsx(x,{size:"sm",variant:"outline",color:"secondary",onClick:()=>j(),children:"CANCELAR"})})]})})]})}),e.jsx(Ie,{ref:t,onResponse:k,message:"¿Estás seguro que quieres cancelar?"})]})}X.propTypes={onCancel:R.func.isRequired,onSave:R.func.isRequired,client:R.object,copying:R.bool,isPopup:R.bool};const Z=({clients:n,fetching:i,page:d,onEdit:c,onCopy:a,onPrevPage:o,onNextPage:u})=>{const h=t=>`[${t.dniType}] ${t.dni}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-lg-none",children:n.map(t=>e.jsx(U,{style:{width:"auto",cursor:"pointer"},className:"my-2",onClick:()=>c(t),children:e.jsx(B,{children:e.jsxs(b,{className:"g-0",children:[e.jsx(r,{xs:"7",children:t.name}),e.jsx(r,{xs:"7",children:h(t)})]})})},t.code))}),e.jsx("div",{className:"d-none d-lg-block",children:e.jsxs(Ce,{small:!0,hover:!0,children:[e.jsx(je,{children:e.jsxs(A,{children:[e.jsx(q,{scope:"col",children:"Nombre"}),e.jsx(q,{scope:"col",children:"Identificación"}),e.jsx(q,{scope:"col",children:"Acciones"})]})}),e.jsx(fe,{children:n.map(t=>e.jsxs(A,{children:[e.jsx(E,{className:"text-uppercase text-break",children:t.name}),e.jsx(E,{children:h(t)}),e.jsxs(E,{children:[e.jsxs(x,{size:"sm",variant:"outline",color:"info",disabled:i,onClick:()=>c(t),children:[e.jsx(I,{icon:De,size:"sm"}),"  EDITAR"]})," ",e.jsxs(x,{size:"sm",variant:"outline",color:"secondary",disabled:i,onClick:()=>a(t),children:[e.jsx(I,{icon:ke,size:"sm"}),"  COPIAR"]})]})]},t.code))}),e.jsxs(ye,{children:[e.jsx(A,{children:e.jsxs(E,{colSpan:5,className:"text-center",children:["Página ",d]})}),e.jsx(A,{className:"mt-2",children:e.jsx(E,{colSpan:5,children:e.jsxs(b,{children:[e.jsx(r,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(x,{type:"button",variant:"outline",color:"secondary",disabled:i,onClick:o,children:"ANTERIOR"})})}),e.jsx(r,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(x,{type:"button",variant:"outline",color:"secondary",disabled:i,onClick:u,children:"SIGUIENTE"})})})]})})})]})]})})]})};Z.propTypes={clients:p.PropTypes.array.isRequired,page:p.PropTypes.number.isRequired,fetching:p.PropTypes.bool.isRequired,onEdit:p.PropTypes.func.isRequired,onCopy:p.PropTypes.func.isRequired,onPrevPage:p.PropTypes.func.isRequired,onNextPage:p.PropTypes.func.isRequired};const{ENTER_KEYCODE:ze,TAB_KEYCODE:qe}=Ee,Le={page:1};function ee(n){const i=M(),d=v(l=>l.clients.clients),c=v(l=>l.clients.saveSuccess),a=v(l=>l.clients.saving),o=v(l=>l.clients.fetching),[u,h]=m.useState("");let[t,C]=m.useState(!!n.isPopup),[D,N]=m.useState(!1),[T,j]=m.useState(null);const[k,g]=m.useState(!1),[s,f]=m.useState(Le),F=m.useRef();m.useEffect(()=>{h(""),i(G({page:1}))},[i]),Re(()=>{c?(H(i,{message:"Guardado exitosamente!"}),n.isPopup&&n.onSave&&n.onSave(),!n.isPopup&&C(!1),j(null),z({page:s.page})):H(i,{message:"No se pudo guardar los datos",color:"danger"})},a,[c]);const y=l=>{l._id?i(Ae(l)):i(Fe(l))},_=async()=>{n.isPopup&&n.onCancel&&n.onCancel(),C(!1)},se=async()=>{const l={...s,page:s.page===1?1:s.page-1};S(l)},ne=async()=>{const l={...s,page:s.page+1};S(l)},ae=({target:{value:l}})=>h(l),le=async({keyCode:l})=>{[ze,qe].includes(l)&&z({page:1})},S=async(l={})=>{f(l),i(G(l))},z=(l={})=>{const P={...l};u&&(P.code=u.trim(),P.name=u.trim()),S(P)},ie=l=>{C(!0),N(!1),j(l)},te=l=>{N(!0),C(!0),j(l)},ce=()=>{j(null),C(!0),N(!1)},oe=()=>{h(""),S({page:1}),F.current.focus()},re=()=>{g(!k)},de=({target:{name:l,value:P}})=>{const ue={...s,page:1,[l]:P};S(ue)};return e.jsx(e.Fragment,{children:e.jsxs(Q,{children:[e.jsx(pe,{children:e.jsx("title",{children:"CLIENTES"})}),e.jsxs(U,{className:"shadow border-10",children:[e.jsx("div",{className:"d-none d-lg-block",children:e.jsxs(be,{children:[!t&&e.jsx(e.Fragment,{children:e.jsxs(b,{children:[e.jsxs(r,{xs:"2",lg:"3",children:["CLIENTES  ",e.jsxs(x,{variant:"outline",color:"success",onClick:ce,children:[e.jsx("div",{className:"d-none d-lg-block",children:"NUEVO"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(I,{icon:Te,size:"sm"})})]})]}),e.jsx(r,{xs:"8",lg:"5",children:e.jsxs(ve,{children:[e.jsx(J,{ref:F,type:"text",name:"searchTerm",placeholder:"...",value:u,onChange:l=>ae(l),onKeyDown:l=>le(l)}),e.jsxs(x,{type:"button",variant:"outline",color:"primary",onClick:()=>z({page:1}),children:[e.jsx("div",{className:"d-none d-lg-block",children:"BUSCAR"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(I,{icon:Se,size:"sm"})})]}),e.jsxs(x,{variant:"outline",type:"button",color:"secondary",onClick:oe,children:[e.jsx("div",{className:"d-none d-lg-block",children:"BORRAR"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(I,{icon:Pe,size:"sm"})})]})]})}),e.jsx(r,{xs:"2",lg:"1",children:e.jsx(x,{color:"link",onClick:re,children:"Filtrar"})}),k&&e.jsxs(e.Fragment,{children:[e.jsx(r,{xs:"2",lg:"1",className:"text-end",children:e.jsx(Ne,{htmlFor:"stock",className:"col-form-label",children:"Stock"})}),e.jsx(r,{xs:"4",lg:"2",children:e.jsx(W,{id:"stock",className:"my-1",value:s.stock,name:"stock",size:"sm",options:[{label:"TODOS",value:""},{label:"DISPONIBLE",value:"IS"},{label:"RECOMPRA",value:"RP"},{label:"NO DISPONIBLE",value:"WS"}],onChange:de})})]})]})}),t&&e.jsxs("div",{className:"d-none d-lg-block",children:[T?D?"COPIANDO":"EDITANDO":"CREANDO"," CLIENTE"]})]})}),e.jsxs(B,{children:[!t&&e.jsx(Z,{clients:d,page:s.page,fetching:o,onEdit:ie,onCopy:te,onPrevPage:se,onNextPage:ne}),t&&e.jsx(X,{isPopup:!0,copying:D,client:T,onSave:y,onCancel:_})]})]})]})})}ee.propTypes={isPopup:p.PropTypes.bool,onCancel:p.PropTypes.func,onSave:p.PropTypes.func};const es=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ee as C,G as a,es as b,Ze as g};
