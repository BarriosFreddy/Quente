import{u as K,r as l,c as R,j as e,V as J}from"./index-zLCb2fgV.js";import{t as z,H as w,I as V,J as W,D as C,E as r,$ as X,O as d,V as Z,W as $,X as I,Y as S,Z as Q,_ as v,a9 as ee,P as se,b as F,K as ae,M as ne}from"./index.esm-CGtd4b9a.js";import{P as q,p as N}from"./DefaultLayout-Dp8_4Mli.js";import{v as ie,g as p,u as re,s as oe}from"./item-categories.service-DURexh54.js";import{C as te}from"./ConfirmDialog-vCIEtcfF.js";import{F as O}from"./FormInput-uIO3-47D.js";import{C as ce}from"./constants-DN2KnU_M.js";import{H as le}from"./Helmet-C40K-Xy2.js";import{s as B}from"./notification.service-CZX6zi9-.js";import{c as de}from"./cil-plus-DmDyxMpI.js";import{c as me}from"./cil-search-C59ySTwT.js";import{c as xe}from"./cil-trash-Bi1lSbbJ.js";import{u as ue}from"./useDidUpdateControl-CLy3MrI-.js";import"./cil-user-Cc0HYXzm.js";import"./SyncService-CJenB6tV.js";import"./DatabaseService-IbC6Bkt9.js";const H={code:"",name:"",description:""},U={code:!1,name:!1,description:!1};function _(a){const c=K(),u=l.useRef(),h=R(n=>n.itemCategories.isCodeRegistered),[o,t]=l.useState(H),[i,m]=l.useState(U),b=a.itemCategory?.code;l.useEffect(()=>{a.itemCategory&&t(a.itemCategory)},[a.itemCategory]);const y=n=>{b!==n&&c(ie(n))},j=({target:{name:n,value:g}})=>{t({...o,[n]:g}),m({...i,[n]:!g}),n==="code"&&y(g)},x=()=>{t(H),c(J(!1)),m(U)},T=()=>{const{code:n,name:g,description:A}={...o},f={...i};return f.code=!n||h,f.name=!g,f.description=!A,m(f),Object.values(f).every(D=>D===!1)},E=async()=>{T()&&(a.onSave({...o}),x())},P=()=>{u.current.show(!0)},k=n=>{n&&a.onCancel(),n||(u.current.show(!1),x())};return e.jsxs(e.Fragment,{children:[e.jsx(z,{fluid:!0,children:e.jsxs(w,{children:[e.jsx(V,{children:e.jsx(W,{className:"row g-3 needs-validation",noValidate:!0,children:e.jsxs(C,{className:"mt-2",children:[e.jsx(r,{xs:"12",lg:"4",children:e.jsx(O,{label:"Código",type:"text",uppercase:"true",name:"code",value:o.code,feedback:h?"El código ya se encuentra registrado":"Campo obligatorio",invalid:h||i.code,required:!0,onChange:n=>j(n)})}),e.jsx(r,{xs:"12",lg:"4",children:e.jsx(O,{label:"Nombre",type:"text",uppercase:"true",name:"name",value:o.name,feedbackInvalid:"Campo obligatorio",invalid:i.name,required:!0,onChange:n=>j(n)})}),e.jsx(r,{xs:"12",lg:"4",children:e.jsx(O,{label:"Descripción",type:"text",uppercase:"true",name:"description",value:o.description,feedbackInvalid:"Campo obligatorio",invalid:i.description,required:!0,onChange:n=>j(n)})})]})})}),e.jsx(X,{className:"mt-2",children:e.jsx(C,{className:"mt-0",children:e.jsxs(r,{className:"text-center",lg:{offset:4,span:4},children:[e.jsx(d,{color:"success",type:"button",onClick:()=>E(),children:a.itemCategory?"EDITAR":"GUARDAR"}),"   ",e.jsx(d,{variant:"outline",color:"secondary",onClick:()=>P(),children:"CANCELAR"})]})})})]})}),e.jsx(te,{ref:u,onResponse:k,message:"¿Estás seguro que quieres cancelar?"})]})}_.propTypes={onCancel:q.func.isRequired,onSave:q.func.isRequired,itemCategory:q.object};function Y({itemCategories:a,fetching:c,page:u,onEdit:h,onPrevPage:o,onNextPage:t}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-lg-none",children:[a&&a.map((i,m)=>e.jsx(w,{style:{width:"auto",cursor:"pointer"},className:"my-2",onClick:()=>h(i),children:e.jsx(C,{className:"g-0",children:e.jsx(r,{xs:12,children:e.jsx(V,{children:e.jsxs(C,{children:[e.jsx(r,{children:i.code}),e.jsx(r,{children:i.name})]})})})})},i.code)),e.jsx(C,{className:"py-1 text-center",children:e.jsxs(r,{children:["Página ",u]})}),e.jsxs(C,{children:[e.jsx(r,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(d,{type:"button",variant:"outline",color:"secondary",disabled:c,onClick:o,children:"ANTERIOR"})})}),e.jsx(r,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(d,{type:"button",variant:"outline",color:"secondary",disabled:c,onClick:t,children:"SIGUIENTE"})})})]})]}),e.jsx("div",{className:"d-none d-lg-block",children:e.jsxs(Z,{small:!0,hover:!0,children:[e.jsx($,{children:e.jsxs(I,{children:[e.jsx(S,{children:"Código"}),e.jsx(S,{children:"Nombre"}),e.jsx(S,{children:"Descripción"}),e.jsx(S,{children:" "})]})}),e.jsx(Q,{children:a&&a.map((i,m)=>e.jsxs(I,{children:[e.jsx(v,{xs:"12",className:"text-uppercase",children:i.code}),e.jsx(v,{className:"fs-6",xs:"12",children:i.name}),e.jsx(v,{xs:"12",className:"text-break",children:i.description}),e.jsx(v,{xs:"12",children:e.jsx(d,{size:"sm",variant:"outline",color:"info",disabled:c,onClick:()=>h(i),children:"EDITAR"})})]},m))}),e.jsxs(ee,{children:[e.jsx(I,{children:e.jsxs(v,{colSpan:5,className:"text-center",children:["Página ",u]})}),e.jsx(I,{className:"mt-2",children:e.jsx(v,{colSpan:5,children:e.jsxs(C,{children:[e.jsx(r,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(d,{type:"button",variant:"outline",color:"secondary",disabled:c,onClick:o,children:"ANTERIOR"})})}),e.jsx(r,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(d,{type:"button",variant:"outline",color:"secondary",disabled:c,onClick:t,children:"SIGUIENTE"})})})]})})})]})]})})]})}Y.propTypes={itemCategories:N.PropTypes.array.isRequired,fetching:N.PropTypes.bool.isRequired,page:N.PropTypes.number.isRequired,onEdit:N.PropTypes.func.isRequired,onPrevPage:N.PropTypes.func.isRequired,onNextPage:N.PropTypes.func.isRequired};const{ENTER_KEYCODE:he,TAB_KEYCODE:je}=ce;function De(){const a=K(),c=R(s=>s.itemCategories.itemCategories),u=R(s=>s.itemCategories.saving),h=R(s=>s.itemCategories.fetching),o=R(s=>s.itemCategories.saveSuccess),[t,i]=l.useState("");let[m,b]=l.useState(null),[y,j]=l.useState(!1),[x,T]=l.useState(1);const E=l.useRef();l.useEffect(()=>{i(""),a(p({page:1}))},[a]),ue(()=>{o?(i(""),a(p({page:x})),j(!1),b(null),B(a,{message:"Guardado exitosamente!"})):B(a,{message:"No se pudo guardar los datos",color:"danger"})},u);const P=s=>{s._id?a(re(s)):a(oe(s))},k=s=>{j(!0),b(s)},n=async()=>{a(p({page:x})),j(!1)},g=async()=>{const s=x+1;T(s),a(p({page:s}))},A=async()=>{const s=x===1?1:x-1;T(s),a(p({page:s}))},f=({target:{value:s}})=>{i(s)},D=async({keyCode:s})=>{[he,je].includes(s)&&G()},G=async()=>{if(t){a(p({code:t.trim(),name:t.trim(),page:1}));return}a(p({page:1}))},L=()=>{j(!0),b(null)},M=()=>{i(""),a(p({page:1})),E.current.focus()};return e.jsx(e.Fragment,{children:e.jsxs(z,{className:"mt-6",children:[e.jsx(le,{children:e.jsx("title",{children:"CATEGORIA DE ITEMS"})}),e.jsxs(w,{className:"mt-6 shadow border-10",children:[e.jsxs(se,{children:[!y&&e.jsxs(C,{children:[e.jsx(r,{xs:"2",lg:"3",children:e.jsxs(d,{variant:"outline",color:"success",onClick:L,children:[e.jsx("div",{className:"d-none d-lg-block",children:"NUEVA"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(F,{icon:de,size:"sm"})})]})}),e.jsx(r,{xs:"8",lg:"5",children:e.jsxs(ae,{children:[e.jsx(ne,{ref:E,type:"text",name:"searchTerm",placeholder:"...",value:t,onChange:s=>f(s),onKeyDown:s=>D(s)}),e.jsxs(d,{type:"button",variant:"outline",color:"primary",onClick:G,children:[e.jsx("div",{className:"d-none d-lg-block",children:"BUSCAR"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(F,{icon:me,size:"sm"})})]}),e.jsxs(d,{variant:"outline",type:"button",color:"secondary",onClick:M,children:[e.jsx("div",{className:"d-none d-lg-block",children:"BORRAR"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(F,{icon:xe,size:"sm"})})]})]})})]}),y&&e.jsxs("div",{className:"d-none d-lg-block",children:[m?"EDITANDO":"CREANDO"," CATEGORIA"]})]}),e.jsxs(V,{children:[!y&&e.jsx(Y,{itemCategories:c,page:x,fetching:h,onEdit:k,onPrevPage:A,onNextPage:g}),y&&e.jsx(_,{itemCategory:m,onSave:P,onCancel:n})]})]})]})})}export{De as default};
