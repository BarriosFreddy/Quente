import{$ as E,a0 as I,u as G,c as f,r as x,j as s}from"./index-zLCb2fgV.js";import{t as L,H as W,P as $,R as k,I as M,V as X,W as Z,X as j,Y as o,Z as J,_ as c,M as A,D,E as R,a5 as Q,O as S,b as ee,a9 as se}from"./index.esm-CGtd4b9a.js";import{H as te}from"./Helmet-C40K-Xy2.js";import{g as re}from"./DefaultLayout-Dp8_4Mli.js";import{C as ae}from"./constants-DN2KnU_M.js";import{u as w}from"./useDidUpdateControl-CLy3MrI-.js";import{c as ie}from"./cil-trash-Bi1lSbbJ.js";import{a as C,b as oe}from"./notification.service-CZX6zi9-.js";import{c as ne}from"./index-CR_XkoXS.js";import{C as K}from"./CurrencyFormInput-CXjMaF9V.js";import"./cil-user-Cc0HYXzm.js";import"./SyncService-CJenB6tV.js";import"./DatabaseService-IbC6Bkt9.js";import"./dayjs.min-Bvy1Uf3G.js";const le=a=>async(n,b,g)=>{n(E(!0));try{const{status:p}=await g.post("/kardex/bulk",a);n(I(p===201))}catch{n(I(!1)),console.error("Error saving all kardex:",error)}finally{n(E(!1))}},T={itemCode:"",itemId:"",itemName:"",itemDescription:"",itemCost:"",itemPrice:"",type:"IN",units:""},{ENTER_KEYCODE:ce,TAB_KEYCODE:de}=ae,me=()=>{const a=G(),n=f(e=>e.items.items),b=f(e=>e.items.fetching),g=f(e=>e.kardexes.saving),p=f(e=>e.kardexes.saveSuccess),[i,d]=x.useState([]),[O,F]=x.useState([]),N=x.useRef();x.useEffect(()=>{d([T])},[]),w(()=>{_()},b),w(()=>{if(p){oe(a,{message:"Guardado exitoso!"}),d([{...T}]);return}else C(a,{message:"No se pudieron guardar los datos!"})},g);const u=({target:{name:e,value:t}},r,m)=>{F(m);const h={...r,[e]:t},l=v(h,m);d(l)},U=()=>{d([...i,T]),setImmediate(()=>N&&N.current.focus())},H=e=>{let t=[...i];e>=0&&t.splice(e,1),d(t)},P=({keyCode:e},t)=>{[ce,de].includes(e)&&V(t.itemCode)},V=e=>{e&&a(re({code:e,page:1,size:1},!1))},q=()=>{if(B()){const e=Y(i);a(le(e))}};function B(){let e=!0;return i.some(t=>t.itemName.trim()==="")&&(C(a,{message:"Hay registros no validos!"}),e=!1),i.some(t=>t.units<=0)&&(C(a,{message:"Por favor ingrese las unidades faltantes"}),e=!1),e}function Y(e){return Array.isArray(e)?e.map(({itemCode:t,itemId:r,itemCost:m,itemPrice:h,type:l,units:y})=>({itemCode:t,itemId:r,...l==="IN"&&{itemCost:m},...l==="IN"&&{itemPrice:h},type:l,units:y,createdAt:ne()})):e}function v(e,t){let r=[...i];return t>=0&&r.splice(t,1,e),r}function _(){if(n.length>0){const{_id:e,code:t,name:r,description:m,cost:h,price:l}=n[0];if(i.some(z=>z.itemId===e)){C(a,{message:`El item "${r}" ya está agregado!`});return}const y=v({itemCode:t,itemId:e,itemName:r,itemDescription:m,type:"IN",units:"",itemCost:h,itemPrice:l},O);d(y);return}C(a,{message:"Item no encontrado"})}return s.jsx(s.Fragment,{children:s.jsxs(L,{className:"mt--6",fluid:!0,children:[s.jsx(te,{children:s.jsx("title",{children:"ENTRADAS Y SALIDAS"})}),s.jsxs(W,{className:"mt-6 shadow border-10",children:[s.jsx($,{children:s.jsx(k,{children:"ENTRADAS Y SALIDAS"})}),s.jsx(M,{children:s.jsxs(X,{small:!0,hover:!0,children:[s.jsx(Z,{children:s.jsxs(j,{children:[s.jsx(o,{children:"Código"}),s.jsx(o,{children:"Nombre"}),s.jsx(o,{children:"Unidades"}),s.jsx(o,{children:"E/S"}),s.jsx(o,{children:"Costo"}),s.jsx(o,{children:"Precio"}),s.jsx(o,{children:" "})]})}),s.jsxs(J,{children:[i.map((e,t)=>s.jsxs(j,{children:[s.jsx(c,{width:200,children:s.jsx(A,{ref:N,type:"number",formNoValidate:!0,required:!0,name:"itemCode",value:e.itemCode,onChange:r=>u(r,e,t),onKeyUp:r=>P(r,e)})}),s.jsxs(c,{className:"text-uppercase",children:[s.jsx(D,{children:s.jsx(R,{className:"text-uppercase",children:e.itemName})}),s.jsx(D,{children:s.jsx(R,{className:"text-uppercase",style:{fontSize:10},children:e.itemDescription})})]}),s.jsx(c,{width:150,children:s.jsx(A,{type:"number",formNoValidate:!0,required:!0,name:"units",value:e.units,onChange:r=>u(r,e,t)})}),s.jsx(c,{width:150,children:s.jsx(Q,{name:"type",value:e.type,required:!0,feedbackInvalid:"Campo obligatorio",onChange:r=>u(r,e,t),options:[{label:"ENTRADA",value:"IN"}]})}),s.jsx(c,{width:150,children:s.jsx(K,{type:"number",formNoValidate:!0,required:!0,name:"itemCost",disabled:e.type==="OUT",value:e.itemCost,onChange:r=>u(r,e,t)})}),s.jsx(c,{width:150,children:s.jsx(K,{type:"number",formNoValidate:!0,required:!0,name:"itemPrice",disabled:e.type==="OUT",value:e.itemPrice,onChange:r=>u(r,e,t)})}),s.jsx(c,{width:100,children:i.length>1&&s.jsx(S,{color:"ligth",onClick:()=>H(t),children:s.jsx(ee,{icon:ie,size:"sm"})})})]},t)),s.jsx(j,{children:s.jsx(o,{colSpan:12,children:s.jsx(S,{variant:"outline",color:"info",onClick:U,children:"NUEVO REGISTRO"})})})]}),s.jsx(se,{children:s.jsx(j,{children:s.jsx(o,{colSpan:12,className:"text-center",children:s.jsx(S,{color:"success",onClick:q,children:"GUARDAR"})})})})]})})]})]})})};me.propTypes={};export{me as default};
