import{a1 as te,a2 as Te,a3 as _,a4 as W,j as e,r as j,u as $,c as v,C as Ee}from"./index-zLCb2fgV.js";import{V as Y,W as ae,X as A,Y as p,Z,_ as S,O as R,a0 as Ie,a1 as we,a2 as Ne,a3 as Pe,D as k,E as I,M as K,a4 as Re,b as re,f as De,a5 as ve,a9 as Ae,t as Oe,H as ke,P as Ue,R as Fe,I as Me}from"./index.esm-CGtd4b9a.js";import{H as Be}from"./Helmet-C40K-Xy2.js";import{u as X}from"./useDidUpdateControl-CLy3MrI-.js";import{a as G,b as He}from"./notification.service-CZX6zi9-.js";import{p as f,g as ie}from"./DefaultLayout-Dp8_4Mli.js";import{D as Ge,P as ze,S as Ve,V as y,T as b,a as _e}from"./react-pdf.browser-CklR2kHB.js";import{C as We}from"./constants-DN2KnU_M.js";import{f as oe,c as Le}from"./index-CR_XkoXS.js";import{c as qe}from"./cil-search-C59ySTwT.js";import{c as Ke}from"./cil-trash-Bi1lSbbJ.js";import{g as Xe}from"./inv-enumerations.service-cECCLzG0.js";import"./cil-user-Cc0HYXzm.js";import"./SyncService-CJenB6tV.js";import"./DatabaseService-IbC6Bkt9.js";import"./dayjs.min-Bvy1Uf3G.js";const $e=a=>async(o,l,u)=>{o(_(!0));try{const{status:n}=await u.post("/purchase-orders",a);o(W(n===201))}catch(n){console.error("Error saving purchase order:",n),o(W(!1))}o(_(!1))},Ye=a=>async(o,l,u)=>{o(_(!0));try{const n={...a},x=n._id;delete n._id;const{status:w}=await u.put(`/purchase-orders/${x}`,n);o(W(w===201))}catch(n){console.error("Error updating purchase order:",n),o(W(!1))}o(_(!1))},Ze=a=>async(o,l,u)=>{o(te(!0));try{const{status:n,data:x}=await u.get("/purchase-orders?page=1",a);n===200&&o(Te(x))}catch(n){console.error("Error fetching purchase orders:",n)}o(te(!1))},le=({purchaseOrders:a,onShow:o})=>e.jsxs(Y,{small:!0,hover:!0,children:[e.jsx(ae,{children:e.jsxs(A,{children:[e.jsx(p,{children:"Código"}),e.jsx(p,{children:"Unidades"}),e.jsx(p,{children:" "})]})}),e.jsx(Z,{children:a.map((l,u)=>e.jsxs(A,{children:[e.jsx(S,{width:200,children:l.code}),e.jsx(S,{width:150,children:l.items?.length}),e.jsx(S,{width:150,children:e.jsx(R,{color:"info",onClick:()=>o(l),children:"VER"})})]},u))})]});le.propTypes={purchaseOrders:f.PropTypes.array,onShow:f.PropTypes.func};const ce=j.forwardRef(function({onResponse:o,onSelect:l},u){const n=$(),[x,w]=j.useState(!1),[d,g]=j.useState(""),O=v(h=>h.items.items);j.useImperativeHandle(u,()=>({show(h){w(h)}}),[]);const D=({target:{value:h}})=>{g(h),h&&n(ie({name:h,page:1}))},F=()=>{c(),w(!1)},m=()=>{w(!1),c()},T=h=>{l&&l(h),m()};function c(){g(""),n(Ee([]))}return e.jsx(e.Fragment,{children:e.jsxs(Ie,{visible:x,onClose:m,children:[e.jsx(we,{onClose:m,children:e.jsx(Ne,{children:"Busqueda por nombre"})}),e.jsxs(Pe,{children:[e.jsx(k,{children:e.jsx(I,{children:e.jsx(K,{type:"text",formNoValidate:!0,required:!0,placeholder:"Buscar...",value:d,onChange:D})})}),e.jsx(k,{children:e.jsx(I,{children:e.jsx(Y,{hover:!0,children:e.jsx(Z,{children:O.map(h=>e.jsx(A,{onClick:()=>T(h),style:{cursor:"pointer"},children:e.jsxs(S,{xs:"12",children:[e.jsx(k,{children:e.jsx(I,{className:"text-uppercase",children:h.name})}),e.jsx(k,{children:e.jsx(I,{style:{fontSize:10},children:h.code})})]})},h.code))})})})})]}),e.jsx(Re,{children:e.jsx(R,{variant:"outline",color:"secondary",onClick:F,children:"Cancelar"})})]})})});ce.propTypes={show:f.PropTypes.bool,onResponse:f.PropTypes.func,onSelect:f.PropTypes.func};const{ENTER_KEYCODE:Je,TAB_KEYCODE:Qe}=We,ne={itemCode:"",itemId:"",itemName:"",itemDescription:"",itemCost:"",itemStock:"",itemMeasurementUnit:"",units:""},de=({measurementUnits:a,onSave:o,saving:l,saveSuccess:u,orderState:n,purchaseOrder:x,onExport:w})=>{const d=$(),[g,O]=j.useState([]),D=v(s=>s.items.items),F=v(s=>s.items.fetching),[m,T]=j.useState([]),[c,h]=j.useState(!1),L=j.useRef(),J=j.useRef(),Q="0000000001";X(()=>{c||(D&&D.length>0?se(D[0]):G(d,{message:"Item no encontrado"}))},F),X(()=>{},l),j.useEffect(()=>{T([ne]),d(Xe("UDM"))},[d]),j.useEffect(()=>{x&&T(Se(x.items))},[x]);const me=s=>{h(!1),s&&d(ie({code:s,page:1,size:1},!1))},z=({target:{name:s,value:t}},r,C)=>{O(C);const N={...r,[s]:t},P=ee(N,C);T(P),s==="itemMeasurementUnit"&&ue(t,r,C)};function ue(s,t,r){debugger;const{cost:C}=m[r].itemPricesRatio.find(N=>N.measurementUnit===s);z({target:{name:"itemCost",value:C}},t,r)}const xe=()=>{T([...m,ne]),setImmediate(()=>L&&L.current.focus())},pe=s=>{let t=[...m];s>=0&&t.splice(s,1),T(t)},je=({keyCode:s},t)=>{[Je,Qe].includes(s)&&me(t.itemCode)},fe=()=>{o&&ye()&&o({code:Q,comments:"",items:be(m),supplierId:"649b892cdfc56ae3c8d56d59",createdAt:Le()})},Ce=s=>{O(s),h(!0),J.current.show(!0)},ge=s=>{se(s)};function ye(){let s=!0;return m.some(t=>t.itemName.trim()==="")&&(G(d,{message:"Hay registros no validos!"}),s=!1),m.some(t=>t.units<=0)&&(G(d,{message:"Por favor ingrese las unidades faltantes"}),s=!1),s}function ee(s,t){let r=[...m];return t>=0&&r.splice(t,1,s),r}function se(s){if(!s)return;const{_id:t,code:r,name:C,description:N,pricesRatio:P,stock:M}=s;if(m.some(E=>E.itemId===t)){G(d,{message:`El item "${C}" ya está agregado!`});return}const B=ee({itemCode:r,itemId:t,itemName:C,itemDescription:N,units:1,itemCost:P.find(E=>E.hash===E.main)?.cost,itemPricesRatio:[...P].sort(E=>E.hash===E.main?-1:1),itemMeasurementUnit:P.find(E=>E.hash===E.main)?.measurementUnit,itemStock:M},g);T(B)}function be(s){if(!Array.isArray(s))return s;debugger;return s.map(({itemName:t,itemCode:r,itemId:C,itemCost:N,itemStock:P,itemMeasurementUnit:M,units:B})=>({code:r,name:t,_id:C,cost:N,stock:P,units:B,measurementUnit:M}))}function Se(s){return Array.isArray(s)?s.map(({code:t,name:r,_id:C,cost:N,stock:P,measurementUnit:M,units:B})=>({itemCode:t,itemId:C,itemName:r,itemCost:N,itemStock:P,itemMeasurementUnit:M,units:B})):s}return e.jsxs(e.Fragment,{children:[e.jsxs(k,{className:"mb-3",children:[e.jsx(I,{lg:"2",className:"fw-semibold",children:"Código serial"}),e.jsx(I,{lg:"2",children:Q}),e.jsx(I,{lg:"2",className:"fw-semibold",children:"Proveedor"}),e.jsx(I,{lg:"2",children:"Distrireal de la costa"})]}),e.jsxs(Y,{small:!0,hover:!0,children:[e.jsx(ae,{children:e.jsxs(A,{children:[e.jsx(p,{children:"Código"}),e.jsx(p,{children:"Nombre"}),e.jsx(p,{children:"Unidades"}),e.jsx(p,{children:"U. de medida"}),e.jsx(p,{children:"Costo"}),e.jsx(p,{children:"Subtotal"}),e.jsx(p,{children:" "})]})}),e.jsxs(Z,{children:[m.map((s,t)=>e.jsxs(A,{children:[e.jsx(S,{width:200,children:e.jsx(K,{ref:L,type:"number",formNoValidate:!0,required:!0,name:"itemCode",value:s.itemCode,onChange:r=>z(r,s,t),onKeyUp:r=>je(r,s)})}),e.jsxs(S,{className:"text-uppercase",children:[e.jsx(R,{type:"button",color:"secondary",variant:"outline",id:"button-addon2",onClick:r=>Ce(t),children:e.jsx(re,{icon:qe,size:"sm"})})," ",s.itemName," ",e.jsx(De,{color:"secondary",shape:"rounded-pill",children:s.itemStock??0})]}),e.jsx(S,{width:100,children:e.jsx(K,{type:"number",formNoValidate:!0,required:!0,name:"units",value:s.units,onChange:r=>z(r,s,t)})}),e.jsx(S,{width:150,children:e.jsx(ve,{name:"itemMeasurementUnit",value:s.itemMeasurementUnit,required:!0,size:"sm",onChange:r=>z(r,s,t),options:[...s.itemPricesRatio?.map(({measurementUnit:r})=>({label:r,value:r}))??[],...a.values??[]]})}),e.jsx(S,{width:150,children:oe(s.itemCost)}),e.jsx(S,{width:150,children:oe(s.itemCost*s.units)}),e.jsx(S,{width:100,children:m.length>1&&e.jsx(R,{color:"ligth",onClick:()=>pe(t),children:e.jsx(re,{icon:Ke,size:"sm"})})})]},t)),e.jsx(A,{children:e.jsx(p,{colSpan:12,children:e.jsx(R,{variant:"outline",color:"info",onClick:xe,children:"NUEVO REGISTRO"})})})]}),e.jsx(Ae,{children:e.jsxs(A,{children:[e.jsx(p,{colSpan:n===U?5:7,className:"text-center",children:e.jsx(R,{color:"success",onClick:fe,children:x?"EDITAR":"GUARDAR"})}),n===U&&e.jsx(p,{colSpan:2,className:"text-center",children:e.jsx(R,{variant:"outline",color:"danger",onClick:w,children:"EXPORTAR A PDF"})})]})})]}),e.jsx(ce,{ref:J,onSelect:ge})]})};de.propTypes={measurementUnits:f.PropTypes.object,purchaseOrder:f.PropTypes.object,saving:f.PropTypes.bool,saveSuccess:f.PropTypes.bool,onSave:f.PropTypes.func,onExport:f.PropTypes.func,orderState:f.PropTypes.string};const he=({purchaseOrder:a})=>e.jsx(Ge,{title:"orden-de-compra",pageLayout:"oneColumn",children:e.jsxs(ze,{size:"A4",style:i.body,children:[e.jsx(y,{style:i.title,children:e.jsx(b,{children:"ORDEN DE COMPRA"})}),e.jsxs(y,{style:i.info,children:[e.jsx(b,{children:"Fecha: 5/07/2023"}),e.jsx(b,{children:"Solicitante: Droguería Francisca"}),e.jsx(b,{children:"Proveedor: Distrireal de la costa"})]}),e.jsxs(y,{style:i.table,children:[e.jsxs(y,{style:i.tableRowHeader,children:[e.jsx(y,{style:[i.tableCol,{width:"70%"}],children:e.jsx(b,{style:i.tableCell,children:"PRODUCTO"})}),e.jsx(y,{style:[i.tableCol,{width:"15%"}],children:e.jsx(b,{style:i.tableCell,children:"CANTIDAD"})}),e.jsx(y,{style:[i.tableCol,{width:"15%"}],children:e.jsx(b,{style:i.tableCell,children:"U. DE MEDIDA"})})]}),console.log({purchaseOrder:a}),a?.items.map(({name:o,units:l,measurementUnit:u},n)=>e.jsxs(y,{style:i.tableRow,children:[e.jsx(y,{style:[i.tableCol,{width:"70%"}],children:e.jsx(b,{style:i.tableCell,children:o})}),e.jsx(y,{style:[i.tableCol,{width:"15%"}],children:e.jsx(b,{style:i.tableCell,children:l})}),e.jsx(y,{style:[i.tableCol,{width:"15%"}],children:e.jsx(b,{style:i.tableCell,children:u})})]},n))]}),e.jsx(b,{style:i.pageNumber,render:({pageNumber:o,totalPages:l})=>`${o} / ${l}`,fixed:!0})]})});he.propTypes={purchaseOrder:f.PropTypes.object};const i=Ve.create({body:{paddingTop:35,paddingBottom:65,paddingHorizontal:35},title:{fontSize:24,textAlign:"center"},info:{fontSize:14,margin:"20 0"},table:{display:"table",width:"auto",borderStyle:"solid",borderWidth:1,borderRightWidth:0,borderBottomWidth:0},tableRowHeader:{margin:"auto",flexDirection:"row",fontWeight:"bold"},tableRow:{margin:"auto",flexDirection:"row"},tableCol:{width:"33%",borderStyle:"solid",borderWidth:1,borderLeftWidth:0,borderTopWidth:0},tableCell:{textAlign:"left",margin:"auto",marginTop:5,fontSize:11},pageNumber:{position:"absolute",fontSize:12,bottom:30,left:0,right:0,textAlign:"center",color:"grey"}}),{CREATING:H,EDITING:U,LISTING:V,EXPORTING:q}={CREATING:"creating",EDITING:"editing",LISTING:"listing",EXPORTING:"exporting"},es=()=>{const a=$(),o=v(c=>c.invEnumerations.invEnumeration),l=v(c=>c.purchaseOrders.saving),u=v(c=>c.purchaseOrders.purchaseOrders),n=v(c=>c.purchaseOrders.saveSuccess),[x,w]=j.useState(null),[d,g]=j.useState(H);X(()=>{if(n){He(a,{message:"Guardado exitoso!"});return}else G(a,{message:"No se pudieron guardar los datos!"})},l);const O=c=>{if(c._id){a(Ye(c));return}a($e(c))},D=()=>{a(Ze()),g(V)},F=c=>{w(c),g(U)},m=()=>{g(q)},T=()=>{switch(d){case U:g(V);break;case V:g(H);break;case q:g(U);break}};return e.jsx(e.Fragment,{children:e.jsxs(Oe,{className:"mt--6",fluid:!0,children:[e.jsx(Be,{children:e.jsx("title",{children:"ORDENES DE COMPRA"})}),e.jsxs(ke,{className:"mt-6 shadow border-10",children:[e.jsx(Ue,{children:e.jsx(Fe,{children:e.jsxs(k,{children:[e.jsx(I,{lg:"3",children:"ORDENES DE COMPRA"}),e.jsxs(I,{lg:{offset:7,span:2},className:"text-end",children:[d===H&&e.jsx(R,{color:"link",onClick:D,children:"HISTORIAL"}),d!==H&&e.jsx(R,{color:"link",onClick:T,children:"REGRESAR"})]})]})})}),e.jsxs(Me,{children:[[U,H].includes(d)&&e.jsx(de,{measurementUnits:o,saving:l,saveSuccess:n,orderState:d,purchaseOrder:x,onSave:O,onExport:m}),d===V&&e.jsx(le,{purchaseOrders:u,onShow:F}),d===q&&e.jsx(_e,{width:"100%",height:"550px",children:e.jsx(he,{purchaseOrder:x})})]})]})]})})};es.propTypes={};export{H as CREATING,U as EDITING,q as EXPORTING,V as LISTING,es as default};
