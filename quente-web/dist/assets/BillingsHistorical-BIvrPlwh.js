import{j as e,r as d,u as fe,c as A,L as ye,Q as Ne}from"./index-zLCb2fgV.js";import{t as se,H as O,P as Ae,D as C,E as n,O as h,b as g,I as k,a6 as De,a7 as R,M as U,a5 as be,V as le,W as ve,X as f,Y as x,Z as ae,_ as i,$ as Te}from"./index.esm-CGtd4b9a.js";import{f as v,d as z}from"./index-CR_XkoXS.js";import{g as D,c as Ee,u as we}from"./billings.service-BJGw8-GG.js";import{B as y}from"./BillingStatus-CwAHNbw6.js";import{H as Se}from"./Helmet-C40K-Xy2.js";import{c as Ie}from"./cil-arrow-left-XthWZumH.js";import{c as Pe}from"./cil-filter-p6GwuJOR.js";import{c as te}from"./cil-trash-Bi1lSbbJ.js";import{D as Re,P as Fe,S as He,V as c,T as a,a as Ve}from"./react-pdf.browser-CklR2kHB.js";import{p as Le}from"./DefaultLayout-Dp8_4Mli.js";import{C as Be}from"./ConfirmDialog-vCIEtcfF.js";import{u as Oe}from"./useDidUpdateControl-CLy3MrI-.js";import{s as M}from"./notification.service-CZX6zi9-.js";import"./dayjs.min-Bvy1Uf3G.js";import"./DatabaseService-IbC6Bkt9.js";import"./cil-user-Cc0HYXzm.js";import"./SyncService-CJenB6tV.js";const re=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='40 16 40 53.828 109.024 136 150.815 136 76.896 48 459.51 48 304 242.388 304 401.373 241.373 464 240 464 240 368 208 368 208 496 254.627 496 336 414.627 336 253.612 496 53.612 496 16 40 16' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='166.403 248.225 226.864 187.763 204.237 165.135 143.775 225.597 83.313 165.135 60.687 187.763 121.148 248.225 60.687 308.687 83.313 331.314 143.775 270.852 204.237 331.314 226.864 308.687 166.403 248.225' class='ci-primary'/>"],ne=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M420,128.1V16H92V128.1A80.1,80.1,0,0,0,16,208V400H84V368H48V208a48.054,48.054,0,0,1,48-48H416a48.054,48.054,0,0,1,48,48V368H420v32h76V208A80.1,80.1,0,0,0,420,128.1Zm-32-.1H124V48H388Z' class='ci-primary'/><rect width='32' height='32' x='396' y='200' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M116,264H76v32h40V496H388V296h40V264H116ZM356,464H148V296H356Z' class='ci-primary'/>"],ke=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"],ie=({billing:m,organization:t})=>e.jsx(Re,{title:"factura",pageLayout:"oneColumn",children:e.jsxs(Fe,{size:"A7",wrap:!1,style:l.body,children:[e.jsxs(c,{style:l.title,children:[e.jsx(a,{children:t?.name?.toUpperCase()}),e.jsx(a,{children:`NIT: ${t?.nit?.toUpperCase()}`}),e.jsx(a,{children:t?.address?.toUpperCase()}),e.jsx(a,{children:`${t?.city?.toUpperCase()} - ${t?.country?.toUpperCase()}`}),e.jsx(a,{children:"FACTURA DE VENTA"})]}),e.jsxs(c,{style:l.info,children:[e.jsxs(a,{children:["CÓDIGO: ",m.code]}),e.jsxs(a,{children:["FECHA: ",m.creationDate]}),e.jsxs(a,{children:["VENDEDOR: ",m.seller?.name||"ANÓNIMO"]}),e.jsxs(a,{children:["CLIENTE: ",m.client?.name||"ANÓNIMO"]})]}),e.jsxs(c,{style:l.tableRow,children:[e.jsx(a,{style:{...l.tableCol,width:"50%"},children:"PRODUCTO"}),e.jsx(a,{style:{...l.tableCol,width:"20%"},children:"CNT"}),e.jsx(a,{style:{...l.tableCol,width:"30%",textAlign:"right"},children:"V. U."})]}),e.jsxs(c,{style:l.table,children:[m?.items.map(({name:u,units:H,price:T},E)=>e.jsxs(c,{style:l.tableRow,children:[e.jsx(c,{style:{...l.tableCol,width:"50%"},children:e.jsx(a,{style:l.tableCell,children:u})}),e.jsx(c,{style:{...l.tableCol,width:"20%"},children:e.jsx(a,{style:l.tableCell,children:H})}),e.jsx(c,{style:{...l.tableCol,width:"30%"},children:e.jsx(a,{style:l.tableCell,children:v(T)})})]},E)),e.jsxs(c,{style:{...l.tableRow,...l.marginBottom10},children:[e.jsx(c,{style:{...l.tableCol,width:"50%"},children:e.jsx(a,{style:l.tableCell,children:" "})}),e.jsx(c,{style:{...l.tableCol,width:"20%"},children:e.jsx(a,{style:l.tableCell,children:"TOTAL"})}),e.jsx(c,{style:{...l.tableCol,width:"30%"},children:e.jsx(a,{style:l.tableCell,children:v(m.billAmount)})})]})]}),e.jsxs(c,{style:{...l.textCenter,...l.marginBottom10},children:[e.jsx(a,{children:"SERVICIO AL CLIENTE"}),e.jsx(a,{children:t?.phoneNumber?.toUpperCase()}),e.jsx(a,{children:"** GRACIAS POR SU COMPRA **"})]})]})});ie.propTypes={billing:Le.PropTypes.object};const l=He.create({body:{fontSize:8,paddingTop:20,paddingBottom:10,paddingHorizontal:10},title:{textAlign:"center"},info:{margin:"10 0"},table:{display:"table",width:"auto"},tableRowHeader:{flexDirection:"row",fontWeight:"bold"},tableRow:{flexDirection:"row"},tableCol:{width:"auto"},tableCell:{textAlign:"left",marginTop:5,fontSize:9},textCenter:{textAlign:"center"},marginBottom10:{marginBottom:10}}),{LISTING:b,DETAILING:F,PRINTING:G}={LISTING:"L",DETAILING:"D",PRINTING:"P"};function ts(){const m=d.useRef(),t=fe(),u=A(s=>s.billing.billings||[]),{organization:H}=A(s=>s.auth.infoUser)??{},T=A(s=>s.billing.offline.billings),E=A(s=>s.billing.saving),Z=A(s=>s.billing.saveSuccess),$=A(s=>s.billing.fetching);let[j,w]=d.useState(null),[V,S]=d.useState(1),[p,L]=d.useState(b),[q,_]=d.useState(!1);const[W,ce]=d.useState(null),[I,oe]=d.useState(!1),[r,X]=d.useState({fromDate:"",toDate:"",status:"",code:""}),Q=d.useMemo(()=>Object.values(r).some(s=>s!==""),[r]);Oe(()=>{if(Z){M(t,{message:"Factura cancelada exitosamente!"});return}M(t,{message:"No se pudo cancelar la factura",color:"danger"})},E,[Z]);const P=s=>{const{name:o,value:N}=s.target;X(B=>({...B,[o]:N}))},de=()=>{if(S(1),r.fromDate&&r.toDate){const o=new Date(r.fromDate),N=new Date(r.toDate);if(o.setUTCHours(0,0,0,0),N.setUTCHours(0,0,0,0),N<o){M(t,{message:"La fecha final debe ser mayor o igual a la fecha inicial",color:"danger"});return}}const s={page:1,status:r.status||null,code:r.code||null,fromDate:r.fromDate?r.fromDate:null,toDate:r.toDate?r.toDate:null,useCache:!1};t(D(s))},he=()=>{X({fromDate:"",toDate:"",status:"",code:""}),S(1),Ee(),t(D({page:1}))},xe=()=>{oe(!I)};d.useEffect(()=>{t(D())},[t]),d.useEffect(()=>{(async()=>await ye()||t(Ne(T)))()},[t,T]);const Y=s=>({page:s,status:r.status||null,code:r.code||null,fromDate:r.fromDate||null,toDate:r.toDate||null}),me=async()=>{const s=V===1?1:V-1;S(s),t(D(Y(s)))},je=async()=>{const s=V+1;S(s),t(D(Y(s)))},J=s=>{w(s),L(F)},K=s=>{w(s),L(G)},ue=()=>{w(null),L(b)},ee=s=>{ce(s),m.current.show(!0)},pe=async s=>{if(s){_(!0);try{await t(we(W._id,y.CANCELED)),w({...W,status:y.CANCELED}),m.current.show(!1),t(D())}catch(o){console.error("Error updating billing status:",o)}finally{_(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx(Se,{children:e.jsx("title",{children:"HISTORIAL DE FACTURAS"})}),e.jsxs(O,{className:"shadow border-10",children:[e.jsx(Ae,{children:e.jsxs(C,{children:[e.jsxs(n,{xs:"2",lg:"3",children:[[F,G].includes(p)&&e.jsxs(h,{variant:"outline",color:"info",onClick:()=>ue(),children:[e.jsx("div",{className:"d-none d-lg-block",children:"Regresar"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(g,{icon:Ie,size:"sm"})})]}),p===b&&e.jsxs(h,{variant:"outline",color:Q?"success":"info",onClick:xe,children:[e.jsx("div",{className:"d-none d-lg-block",children:I?"Ocultar Filtros":"Filtros"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(g,{icon:I?re:Pe,size:"sm"})})]})]}),e.jsx(n,{xs:"8",lg:"6",className:"text-center",children:"HISTORIAL"}),e.jsxs(n,{xs:"2",lg:"3",className:"text-end",children:[[F].includes(p)&&e.jsxs(h,{variant:"outline",color:"secondary",onClick:()=>K(j),children:[e.jsx("div",{className:"d-none d-lg-block",children:"Imprimir"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(g,{icon:ne,size:"sm"})})]}),p===b&&Q&&e.jsxs(h,{variant:"outline",color:"danger",onClick:he,children:[e.jsx("div",{className:"d-none d-lg-block",children:"Limpiar"}),e.jsx("div",{className:"d-lg-none",children:e.jsx(g,{icon:re,size:"sm"})})]})]})]})}),e.jsx(k,{children:e.jsxs(se,{className:"mt--6",fluid:!0,children:[p===b&&e.jsx(De,{visible:I,children:e.jsx(O,{className:"mb-4 shadow-sm border-0",children:e.jsxs(k,{children:[e.jsx("h6",{className:"mb-3",children:"Filtros de Búsqueda"}),e.jsxs(C,{className:"g-3",children:[e.jsxs(n,{xs:"12",md:"6",lg:"3",children:[e.jsx(R,{children:"Desde"}),e.jsx(U,{type:"date",name:"fromDate",value:r.fromDate,onChange:P})]}),e.jsxs(n,{xs:"12",md:"6",lg:"3",children:[e.jsx(R,{children:"Hasta"}),e.jsx(U,{type:"date",name:"toDate",value:r.toDate,onChange:P})]}),e.jsxs(n,{xs:"12",md:"6",lg:"3",children:[e.jsx(R,{children:"Estado"}),e.jsxs(be,{name:"status",value:r.status,onChange:P,children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:y.APPROVED,children:"Aprobado"}),e.jsx("option",{value:y.CANCELED,children:"Cancelado"})]})]}),e.jsxs(n,{xs:"12",md:"6",lg:"3",children:[e.jsx(R,{children:"Código"}),e.jsx(U,{type:"text",name:"code",value:r.code,onChange:P,placeholder:"Buscar por código"})]}),e.jsx(n,{xs:"12",className:"d-flex justify-content-end mt-3",children:e.jsx(h,{color:"primary",onClick:de,disabled:$,children:$?"Aplicando...":"Aplicar Filtros"})})]})]})})}),e.jsxs(C,{children:[p===b&&e.jsx(n,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-lg-none",children:Array.isArray(u)&&u.length>0?u.map((s,o)=>e.jsx(O,{style:{width:"auto",cursor:"pointer"},className:"my-2",onClick:()=>J(s),children:e.jsx(k,{children:e.jsxs(C,{className:"g-0",children:[e.jsx(n,{xs:"4",children:e.jsx("h6",{children:"Fecha:"})}),e.jsxs(n,{xs:"8",children:[e.jsx(C,{children:z(s.createdAt)}),e.jsx(C,{children:s.code}),e.jsxs(C,{children:["Productos: ",s.items?.length]})]}),e.jsx(n,{xs:"8",children:v(s.total)})]})})},o)):e.jsx("div",{className:"text-center p-4",children:"No hay facturas para mostrar"})}),e.jsx("div",{className:"d-none d-lg-block",children:e.jsxs(le,{hover:!0,children:[e.jsx(ve,{children:e.jsxs(f,{children:[e.jsx(x,{children:"Fecha"}),e.jsx(x,{children:"Código"}),e.jsx(x,{children:"N° de productos"}),e.jsx(x,{children:"Total"}),e.jsx(x,{children:"Estado"}),e.jsx(x,{children:"Acciones"})]})}),e.jsx(ae,{children:Array.isArray(u)&&u.length>0?u.map((s,o)=>e.jsxs(f,{children:[e.jsx(i,{xs:"12",className:"text-uppercase",children:z(s.createdAt)}),e.jsx(i,{className:"fs-6",children:s.code?s.code:"No Disponible"}),e.jsx(i,{children:s.items?.length}),e.jsx(i,{children:v(s.total||s.billAmount)}),e.jsx(i,{children:s.status===y.APPROVED?e.jsx("span",{className:"text-success",children:"APROBADA"}):e.jsx("span",{className:"text-danger",children:"CANCELADA"})}),e.jsxs(i,{children:[e.jsxs(h,{size:"sm",variant:"outline",color:"info",onClick:()=>J(s),children:[e.jsx(g,{icon:ke,size:"sm"}),"  Detalle"]})," ",e.jsxs(h,{size:"sm",variant:"outline",color:"secondary",onClick:()=>K(s),children:[e.jsx(g,{icon:ne,size:"sm"}),"  Imprimir"]})," ",s.status!==y.CANCELED&&e.jsxs(h,{size:"sm",variant:"outline",color:"danger",onClick:()=>ee(s),disabled:q||E,children:[e.jsx(g,{icon:te,size:"sm"}),"  Cancelar"]})]})]},o)):e.jsx(f,{children:e.jsx(i,{colSpan:"6",className:"text-center p-4",children:"No hay facturas para mostrar"})})})]})}),e.jsx(Te,{className:"py-4",children:e.jsxs(C,{children:[e.jsx(n,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(h,{type:"button",variant:"outline",color:"secondary",onClick:me,children:"ANTERIOR"})})}),e.jsx(n,{children:e.jsx("div",{className:"d-grid col-12 mx-auto",children:e.jsx(h,{type:"button",variant:"outline",color:"secondary",onClick:je,children:"SIGUIENTE"})})})]})})]})}),p===G&&e.jsx(e.Fragment,{children:e.jsx(Ve,{width:"100%",height:"550px",children:e.jsx(ie,{billing:j,organization:H})})}),p===F&&e.jsx(n,{children:e.jsx(le,{small:!0,hover:!0,children:e.jsxs(ae,{children:[e.jsxs(f,{children:[e.jsx(x,{lg:"2",children:"Fecha"}),e.jsx(i,{children:z(j.createdAt)}),e.jsx(x,{lg:"3",children:"Código"}),e.jsx(i,{colSpan:2,children:j.code})]}),e.jsxs(f,{children:[e.jsx(x,{children:"Estado"}),e.jsx(i,{colSpan:4,children:j.status===y.APPROVED?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-success",children:"APROBADA"}),j.status===y.APPROVED&&e.jsxs(h,{size:"sm",variant:"outline",color:"danger",onClick:()=>ee(j),disabled:q,className:"ms-3",children:[e.jsx(g,{icon:te,size:"sm"}),"  Cancelar"]})]}):e.jsx("span",{className:"text-danger",children:"CANCELADA"})})]}),e.jsx(f,{children:e.jsx(x,{colSpan:5,children:"Items"})}),j.items?.map(({_id:s,name:o,units:N,price:B,measurementUnit:Ce},ge)=>e.jsxs(f,{children:[e.jsx(i,{colSpan:2,children:o}),e.jsx(i,{colSpan:2,children:N+" "+Ce}),e.jsx(i,{colSpan:2,children:B})]},ge)),e.jsx(f,{children:e.jsxs(x,{className:"text-end fs-4",colSpan:5,children:["Total ",v(j.billAmount)]})})]})})})]})]})})]})]}),e.jsx(Be,{ref:m,onResponse:pe,message:"¿Estás seguro que quieres cancelar esta factura?"})]})}export{F as DETAILING,b as LISTING,G as PRINTING,ts as default};
